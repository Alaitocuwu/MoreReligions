ask_to_become_independent_vassal = {
	category = influence

	alert_index = 6
	alert_tooltip = demand_independent_vassal

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject = no
		}
		is_subject = no
	}
	is_allowed = {
		#checks if asker has more prestige than recipient
		variable_arithmetic_trigger = {
			custom_tooltip = HAS_MORE_PRESTIGE_THAN_GUY_BEING_ASKED
			export_to_variable = {
				variable_name = my_prestige
				value = trigger_value:prestige
			}
			export_to_variable = {
				variable_name = their_prestige
				value = trigger_value:prestige
				who = FROM
			}
			prestige = 0
			check_variable = {
				which = my_prestige
				which = their_prestige
			}
		}
		#checks if asker has at least 1.5x more dev than recipient
		variable_arithmetic_trigger = {
			custom_tooltip = HAS_MORE_DEV_THAN_GUY_BEING_ASKED
			export_to_variable = {
				variable_name = my_dev
				value = trigger_value:total_development
			}
			export_to_variable = {
				variable_name = their_dev
				value = trigger_value:total_development
				who = FROM
			}
			multiply_variable = {            
				which = their_dev
				value = 1.5
			}
			check_variable = {
				which = my_dev
				which = their_dev
			}
		}
		is_at_war = no
	}
	on_accept = {
		create_subject = {
			subject_type = mr_independent_vassal
			subject = FROM
		}
	}
	on_decline = {
		#nothing
	}
	ai_acceptance = {
		add_entry = {
			limit = {
				FROM = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_friendly
					}
				}
			}
			name = FRIENDLY_ATTITUDE_TO_ROOT
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			NAME = GOVERNMENT_RANK_DIFFERENCE_OF_ONE
			limit = {
				OR = {
					AND = {
						FROM = { government_rank = 2 }
						ROOT = { government_rank = 3 }
					}
					AND = {
						FROM = { government_rank = 1 }
						ROOT = { government_rank = 2 }
					}
				}
			}
			export_to_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			NAME = GOVERNMENT_RANK_DIFFERENCE_OF_TWO
			limit = {
				FROM = { government_rank = 1 }
				ROOT = { government_rank = 3 }
			}
			export_to_variable = {
				which = ai_value
				value = 20
			}
		}
		add_entry = {
			NAME = ROOT_DIP_REP
			export_to_variable = {
				which = ai_value
				value = modifier:diplomatic_reputation
			}
			multiply_variable = { which = ai_value value = 3 }
		}
		add_entry = {
			name = TRUST
			export_to_variable = {
				which = ai_value
				value = trust
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = OPINION
			export_to_variable = {
				which = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			divide_variable = { which = ai_value value = 4 }
		}
		add_entry = {
			name = FROM_HAS_SUBJECTS
			limit = {
				FROM = {
					num_of_subjects = 1
				}
			}
			export_to_variable = {
				which = ai_value
				value = -1000
			}
		}
	}

	ai_will_do = { # this is a trigger
		# has_opinion_modifier = {
			# modifier = insulted
			# who = FROM
		# }
	}
}

cancel_independent_vassal =  {
	category = influence
	require_acceptance = no
	is_visible = {
		overlord_of = FROM
		FROM = {
			is_subject_of_type = mr_independent_vassal
		}
	}
	is_allowed = {
		is_at_war = no
	}
	on_accept = {
		add_trust = {
			who = FROM
			value = -35
			mutual = yes
		}
		FROM = {
			grant_independence = yes
		}
	}
	ai_will_do = {
		OR = {
			any_country = {
				is_supporting_independence_of = ROOT
			}
			liberty_desire = 90
		}
	}
}
